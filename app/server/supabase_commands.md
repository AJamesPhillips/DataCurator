Enable all actions for users based on their id and base_id
(uid() = base_id)




```sql

DROP TABLE IF EXISTS knowledge_views;
DROP TABLE IF EXISTS wcomponents;
DROP TABLE IF EXISTS access_controls;
DROP TABLE IF EXISTS bases;


CREATE TABLE IF NOT EXISTS bases (
  id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  inserted_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  owner_user_id uuid references auth.users NOT NULL,
  public_read boolean DEFAULT false NOT NULL,
  title text DEFAULT '' NOT NULL
);
CREATE INDEX bases_owner_user_id_index ON bases ( owner_user_id );



CREATE TYPE AccessControlLevel AS ENUM ('editor', 'viewer');
-- DROP TYPE AccessControlLevel;
CREATE TABLE IF NOT EXISTS access_controls (
  base_id bigint NOT NULL,
  user_id uuid references auth.users NOT NULL,
  inserted_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  access_level AccessControlLevel NOT NULL,
  PRIMARY KEY(base_id, user_id),
  CONSTRAINT fk_access_controls_base
    FOREIGN KEY(base_id)
	  REFERENCES bases(id)
);



CREATE TABLE IF NOT EXISTS knowledge_views (
  id uuid NOT NULL DEFAULT uuid_generate_v4() PRIMARY KEY,
  modified_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  base_id bigint NOT NULL,
  title text NOT NULL,
  json json NOT NULL,
  CONSTRAINT fk_knowledge_views_base
    FOREIGN KEY(base_id)
	  REFERENCES bases(id)
);




CREATE TABLE IF NOT EXISTS wcomponents (
  id uuid NOT NULL DEFAULT uuid_generate_v4() PRIMARY KEY,
  modified_at timestamp with time zone DEFAULT timezone('utc'::text, now()) NOT NULL,
  base_id bigint NOT NULL,
  title text NOT NULL,
  json json NOT NULL,
  CONSTRAINT fk_wcomponents_base
    FOREIGN KEY(base_id)
	  REFERENCES bases(id)
);



alter table public.bases enable row level security;
alter table public.access_controls enable row level security;
alter table public.knowledge_views enable row level security;
alter table public.wcomponents enable row level security;

CREATE policy "Users can read their own bases" on public.bases for select using ( auth.uid() = owner_user_id );
CREATE policy "Users can insert their own bases" on public.bases for insert with check ( auth.uid() = owner_user_id );
CREATE policy "Users can update their own bases" on public.bases for update using ( auth.uid() = owner_user_id ) with check ( auth.uid() = owner_user_id );


CREATE policy "Users can read their own bases knowledge views" on public.knowledge_views for select using ( auth.uid() in (SELECT owner_user_id from public.bases WHERE id = base_id) );
CREATE policy "Users can insert their own bases knowledge views" on public.knowledge_views for insert with check ( auth.uid() in (SELECT owner_user_id from public.bases WHERE id = base_id) );
CREATE policy "Users can update their own bases knowledge views" on public.knowledge_views for update using ( auth.uid() in (SELECT owner_user_id from public.bases WHERE id = base_id) ) with check ( auth.uid() in (SELECT owner_user_id from public.bases WHERE id = base_id) );

-- CREATE policy "Users can read their another users bases knowledge views when editor or viewer" on public.knowledge_views for select using ( auth.uid() in (SELECT owner_user_id from public.bases WHERE id = base_id) );





```







```sql
CREATE OR REPLACE FUNCTION show_create_table(table_name text, join_char text = E'\n' )
  RETURNS text AS
$BODY$
SELECT 'CREATE TABLE ' || $1 || ' (' || $2 || '' ||
    string_agg(column_list.column_expr, ', ' || $2 || '') ||
    '' || $2 || ');'
FROM (
  SELECT '    ' || column_name || ' ' || data_type ||
       coalesce('(' || character_maximum_length || ')', '') ||
       case when is_nullable = 'YES' then '' else ' NOT NULL' end as column_expr
  FROM information_schema.columns
  WHERE table_schema = 'public' AND table_name = $1
  ORDER BY ordinal_position) column_list;
$BODY$
  LANGUAGE SQL STABLE;



select show_create_table('knowledge_views');
```
